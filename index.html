
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GeoJSON Modelica Translator Documentation &#8212; GeoJSON Modelica Translator v0.0.1 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/custom_sphinx_styles.css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="License" href="license.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="license.html" title="License"
             accesskey="N">next</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">GeoJSON Modelica Translator v0.0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">GeoJSON Modelica Translator Documentation</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="geojson-modelica-translator-documentation">
<h1>GeoJSON Modelica Translator Documentation<a class="headerlink" href="#geojson-modelica-translator-documentation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-2-0">Version 0.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#version-0-1-0">Version 0.1.0</a></li>
</ul>
</li>
</ul>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="_autosummary/geojson_modelica_translator.html#module-geojson_modelica_translator" title="geojson_modelica_translator"><code class="xref py py-obj docutils literal notranslate"><span class="pre">geojson_modelica_translator</span></code></a></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<div class="section" id="geojson-modelica-translator">
<span id="readme"></span><h2>GeoJSON Modelica Translator<a class="headerlink" href="#geojson-modelica-translator" title="Permalink to this headline">¶</a></h2>
<a class="reference external image-reference" href="https://travis-ci.org/urbanopt/geojson-modelica-translator"><img alt="https://travis-ci.org/urbanopt/geojson-modelica-translator.svg?branch=develop" src="https://travis-ci.org/urbanopt/geojson-modelica-translator.svg?branch=develop" /></a>
<a class="reference external image-reference" href="https://coveralls.io/github/urbanopt/geojson-modelica-translator?branch=develop"><img alt="https://coveralls.io/repos/github/urbanopt/geojson-modelica-translator/badge.svg?branch=develop" src="https://coveralls.io/repos/github/urbanopt/geojson-modelica-translator/badge.svg?branch=develop" /></a>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The GeoJSON Modelica Translator (GMT) is a one-way trip from GeoJSON in combination with a well-defined instance of the system parameters schema to a Modelica project with multiple buildings loads, energy transfer stations, district system, and distribution network. The project will eventually allow multiple paths to build up different district heating and cooling system topolologies; however, the initial implementation is limited to 1GDH and 4GDC.</p>
</div>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>The GeoJSON Modelica Translator is in alpha-phase development and the functionality is limited. Currently, the proposed approach for getting started is outlined in this readme. Currently you need Python 3 and Pip 3 to install/build the packages. Python 2 is at end of life and should be avoided; however, Python 2 may still be needed to run the models with JModelica (this is actively being evaluated). Note that the best approach is to use Docker to run the Modelica models as this approach does not require Python 2.</p>
<ul class="simple">
<li><p>Clone this repo into a working directory</p></li>
<li><p>(optional/as-needed) Add Python 3 to the environment variables</p></li>
<li><p>Install <a class="reference external" href="https://docs.docker.com/get-docker/">Docker</a> for your platform</p></li>
<li><p>Configure Docker on your local desktop to have at least 4 GB Ram and 2 Cores. This is configured under the Docker Preferences.</p></li>
<li><p><strong>Follow first 3 major bullets in Running Simulations section below.</strong></p></li>
<li><p>Run <code class="code docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-r</span> <span class="pre">requirements.txt</span></code></p></li>
<li><p>Test if everything is installed correctly by running <code class="code docutils literal notranslate"><span class="pre">py.test</span></code></p></li>
</ul>
<p>The py.test tests should all pass assuming the libraries are installed correctly on your computer. Also, there will be a set of Modelica models that are created and persisted into the <code class="code docutils literal notranslate"><span class="pre">tests/output</span></code> folder and the <code class="code docutils literal notranslate"><span class="pre">tests/model_connectors/output</span></code> folder.</p>
<div class="section" id="developers">
<h3>Developers<a class="headerlink" href="#developers" title="Permalink to this headline">¶</a></h3>
<p>This project uses several dependencies that are under active development (e.g., modelica-builder, TEASER, etc). Since
these are included as dependent project using git there may be a need to force an update from the dependent git repos.
The best way to accomplish this is run the following command:</p>
<p>This project used <a class="reference external" href="https://pre-commit.com/">pre-commit</a> to ensure code consistency. To enable pre-commit, run the following from the command line.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install pre-commit
pre-commit install
</pre></div>
</div>
<p>Make sure to install <a class="reference external" href="https://github.com/urbanopt/modelica-fmt/releases">modelica-fmt</a> in order for pre-commit to run code cleanup on Modelica files. The latest prerelease or release is recommended. Once you download the package, place the modelicafmt binary into a folder that is in your path.</p>
<p>To run pre-commit against the files without calling git commit, then run the following. This is useful when cleaning up the repo before committing.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pre-commit run --all-files
</pre></div>
</div>
<div class="section" id="geojson">
<h4>GeoJSON<a class="headerlink" href="#geojson" title="Permalink to this headline">¶</a></h4>
<p>This module manages the connection to the GeoJSON file including any calculations that are needed. Calculations can include distance calculations, number of buildings, number of connections, etc.</p>
<p>The GeoJSON model should include checks for ensuring the accuracy of the area calculations, non-overlapping building areas and coordinates, and various others.</p>
</div>
<div class="section" id="load-model-connectors">
<h4>Load Model Connectors<a class="headerlink" href="#load-model-connectors" title="Permalink to this headline">¶</a></h4>
<p>The Model Connectors are libraries that are used to connect between the data that exist in the GeoJSON with a model-based engine for calculating loads (and potentially energy consumption). Examples includes, TEASER, Data-Driven Model (DDM), CSV, Spawn, etc.</p>
</div>
<div class="section" id="simulation-mapper-class-translator">
<h4>Simulation Mapper Class / Translator<a class="headerlink" href="#simulation-mapper-class-translator" title="Permalink to this headline">¶</a></h4>
<p>The Simulation Mapper Class can operate at mulitple levels:</p>
<ol class="arabic simple">
<li><p>The GeoJSON level – input: geojson, output: geojson+</p></li>
<li><p>The Load Model Connection – input: geojson+, output: multiple files related to building load models (spawn, rom, csv)</p></li>
<li><p>The Translation to Modelica – input: custom format, output: .mo (example inputs: geojson+, system design parameters). The translators are implicit to the load model connectors as each load model requires different paramters to calculate the loads.</p></li>
</ol>
<p>In some cases, the Level 3 case (translation to Modelica) is a blackbox method (e.g. TEASER) which prevents a simulation mapper class from existing at that level.</p>
</div>
</div>
</div>
<div class="section" id="running-simulations">
<h2>Running Simulations<a class="headerlink" href="#running-simulations" title="Permalink to this headline">¶</a></h2>
<p>Currently simulations are runnable using JModelica (via Docker). In the future the plan is to enable a method that
will automatically run the models without having to follow the steps below.</p>
<ul>
<li><p>Clone <a class="reference external" href="https://github.com/lbl-srg/docker-ubuntu-jmodelica">https://github.com/lbl-srg/docker-ubuntu-jmodelica</a> and follow the set up instructions</p></li>
<li><dl class="simple">
<dt>Clone <a class="reference external" href="https://github.com/lbl-srg/modelica-buildings/">https://github.com/lbl-srg/modelica-buildings/</a></dt><dd><ul class="simple">
<li><p>Move insde the modelica-buildings repo you just checked out</p></li>
<li><p>Pull the correct branch with: <code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">issue1437_district_heating_cooling</span></code></p></li>
<li><dl class="simple">
<dt>Install git-lfs</dt><dd><ul>
<li><p>Mac: <code class="code docutils literal notranslate"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">git-lfs;</span> <span class="pre">git</span> <span class="pre">lfs</span> <span class="pre">install</span></code></p></li>
<li><p>Ubuntu: <code class="code docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">git-lfs;</span> <span class="pre">git</span> <span class="pre">lfs</span> <span class="pre">install</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><p>Add the Buildings Library path to your MODELICAPATH environment variable (e.g., export MODELICAPATH=${MODELICAPATH}:$HOME/path/to/modelica-buildings).</p></li>
<li><dl class="simple">
<dt>Example simulation:</dt><dd><ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">jm_ipython.sh</span> <span class="pre">jmodelica.py</span> <span class="pre">spawn_two_building.Loads.B5a6b99ec37f4de7f94020090.building</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">jm_ipython.sh</span> <span class="pre">jmodelica.py</span> <span class="pre">spawn_two_building/Loads/B5a6b99ec37f4de7f94020090/building.mo</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Visualize the results by inspecting the resulting mat file using BuildingsPy.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">buildingspy.io.outputfile</span> <span class="kn">import</span> <span class="n">Reader</span>

<span class="n">mat</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="s2">&quot;tests&quot;</span><span class="p">,</span> <span class="s2">&quot;model_connectors&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;spawn_two_building_Loads_B5a6b99ec37f4de7f94020090_building_result.mat&quot;</span><span class="p">),</span>
    <span class="s2">&quot;dymola&quot;</span>
<span class="p">)</span>
<span class="c1"># List off all the variables</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">mat</span><span class="o">.</span><span class="n">varNames</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

<span class="p">(</span><span class="n">time1</span><span class="p">,</span> <span class="n">zn_1_temp</span><span class="p">)</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s2">&quot;znPerimeter_ZN_1.vol.T&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="n">_time1</span><span class="p">,</span> <span class="n">zn_4_temp</span><span class="p">)</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s2">&quot;znPerimeter_ZN_4.vol.T&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-whitegrid&#39;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time1</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">,</span> <span class="n">zn_1_temp</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$T_1$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time1</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">,</span> <span class="n">zn_4_temp</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$T_4$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [h]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;temperature [$^\circ$C]&#39;</span><span class="p">)</span>
<span class="c1"># Simulation is only for 168 hours?</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">168</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="managed-tasks">
<h2>Managed Tasks<a class="headerlink" href="#managed-tasks" title="Permalink to this headline">¶</a></h2>
<div class="section" id="updating-schemas">
<h3>Updating Schemas<a class="headerlink" href="#updating-schemas" title="Permalink to this headline">¶</a></h3>
<p>There is managed task to automatically pull updated GeoJSON schemas from the <code class="code docutils literal notranslate"><span class="pre">urbanopt-geojson-gem</span></code> GitHub project. A developer can run this command by calling</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./setup.py update_schemas
</pre></div>
</div>
<p>The developer should run the test suite after updating the schemas to ensure that nothing appears to have broken. Note that the tests do not cover all of the properties and should not be used as proof that everything works with the updated schemas.</p>
</div>
<div class="section" id="updating-licenses">
<h3>Updating Licenses<a class="headerlink" href="#updating-licenses" title="Permalink to this headline">¶</a></h3>
<p>To apply the copyright/license to all the files, run the following managed task</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./setup.py update_licenses
</pre></div>
</div>
</div>
</div>
<div class="section" id="templating-diagram">
<h2>Templating Diagram<a class="headerlink" href="#templating-diagram" title="Permalink to this headline">¶</a></h2>
<img alt="ConnectionTemplate.png" src="ConnectionTemplate.png" />
</div>
<div class="section" id="release-instructions">
<h2>Release Instructions<a class="headerlink" href="#release-instructions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Bump version to &lt;NEW_VERSION&gt; in setup.py (use semantic versioning as much as possible).</p></li>
<li><p>Run <cite>autopep8</cite> to nicely format the code (or run <cite>pre-commit –all-files</cite>).</p></li>
<li><p>Create a PR against develop into main.</p></li>
<li><p>After main branch passes, then merge and checkout the main branch. Build the distribution using the following code:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove old dist packages</span>
rm -rf dist/*
python setup.py sdist
</pre></div>
</div>
<ul class="simple">
<li><p>Run <cite>git tag &lt;NEW_VERSION&gt;</cite>. (Note that <cite>python setup.py –version</cite> pulls from the latest tag.)</p></li>
<li><p>Verify that the files in the dist/* folder have the correct version (no dirty, no sha)</p></li>
<li><p>Run the following to release</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install twine
twine upload dist/*
</pre></div>
</div>
<ul class="simple">
<li><p>Build and release the documentation</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build and verify with the following</span>
python setup.py build_sphinx

<span class="c1"># release using</span>
./docs/publish_docs.sh
</pre></div>
</div>
<ul class="simple">
<li><p>Push the tag to GitHub after everything is published to PyPi, then go to GitHub and add in the CHANGELOG.rst notes into the tagged release and officially release.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git push origin &lt;NEW_VERSION&gt;
</pre></div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">GeoJSON Modelica Translator Documentation</a><ul>
<li><a class="reference internal" href="#geojson-modelica-translator">GeoJSON Modelica Translator</a></li>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li><a class="reference internal" href="#running-simulations">Running Simulations</a></li>
<li><a class="reference internal" href="#managed-tasks">Managed Tasks</a></li>
<li><a class="reference internal" href="#templating-diagram">Templating Diagram</a></li>
<li><a class="reference internal" href="#release-instructions">Release Instructions</a></li>
</ul>
</li>
</ul>

  <h4>Next topic</h4>
  <p class="topless"><a href="license.html"
                        title="next chapter">License</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="license.html" title="License"
             >next</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">GeoJSON Modelica Translator v0.0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">GeoJSON Modelica Translator Documentation</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019-2020, Alliance for Sustainable Energy, LLC.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>